apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  labels:
    app.kubernetes.io/name: "scaling-history-recorder"
  name: shr-pvc
  namespace: robot
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 30Gi
  storageClassName: default
---



---
apiVersion: v1
kind: Pod
metadata:
  name: scaling-history-recorder
  namespace: robot
  labels:
    app.kubernetes.io/name: "scaling-history-recorder"
    networking.gardener.cloud/to-dns: allowed
    networking.gardener.cloud/to-runtime-apiserver: allowed
    networking.resources.gardener.cloud/to-kube-apiserver-tcp-443: allowed
    role: cluster-autoscaler
    app: kubernetes
    gardener.cloud/role: controlplane
spec:
  terminationGracePeriodSeconds: 30
  serviceAccount: "robot"
  containers:
    - name: recorder
      image: ${DOCKERHUB_USER}/scaling-history-recorder:latest
      ports:
        - containerPort: 8080
      resources:
        requests:
          memory: 12Gi
        limits:
          memory: 14Gi
      env:
        - name: MODE
          value: in-utility-cluster
        - name: DB_DIR
          value: /db
      volumeMounts:
        - mountPath: /db
          name: db-dir
        - mountPath: /app/secrets/gardens
          name: robot-gardens
        - mountPath: /cfg
          name: recorder-config
  volumes:
    - name: db-dir
      persistentVolumeClaim:
        claimName: shr-pvc
    - name: robot-gardens
      secret:
        defaultMode: 420
        secretName: robot-gardens
    - name: recorder-config
      projected:
        sources:
        - configMap:
            name: scaling-history-recorder-config